# JPA 예상 질문

### JDBC에 대해서 설명해주세요

<details>

자바에서 데이터베이스에 연결 및 작업하기 위한 자바 표준 인터페이스입니다. 데이터베이스 벤더와는 상관없이 하나의 jdbc api를 이용해 데이터베이스에서 작업을 처리할 수 있습니다.

</details>

### JPA Global Fetch 전략에 대해서 설명해주세요

<details>

해당 엔티티를 조회할 때 연관된 엔티티를 함께 조회할 것인지 아닌지를 설정하는 것을 말합니다.
종류는 eager, lazy 두 가지가 있습니다. eager는 연관된 엔티티를 함께 조회하는 것을 말하고 lazy는 함께 조회하지 않고 연관된 엔티티를 프록시 객체로 담아놓고 실제 사용할 때 데이터베이스에 조회하는 것을 말합니다.
기본적으로 ManyToOne, OneToOne 은 eager 전략을 사용하고 ManyToMany, OneToMany는 lazy 전략을 사용합니다.

</details>

### JPA N+1 문제에 대해서 설명해주세요

<details>

엔티티를 조회할 때 연관 관계에 있는 엔티티의 개수만큼 N번 조회 그리고 해당 엔티티 조회 쿼리 한번 발생하여 한번 발생해야 될 쿼리가 N번 더 발생하여 성능 이슈를 일으키는 것을 말합니다.

</details>

### JPA N+1 해결하는 방법에 대해서 설명해주세요

<details>

해결하기 위해 총 세 가지 방법이 있습니다.
첫 번째로, GlobalFetch 전략을 EAGER에서 LAZY로 변경시키는 방법이 있습니다.
두 번째로, Fetch join을 이용해서 조회 시에 연관된 엔티티의 데이터들도 함께 조회해서 가져오는 방식이 있습니다.
세 번째로, EntityGraph라는 어노테이션을 이용하여 페치 조인을 하는 방법이 있습니다. 이 방식은 페치 조인과 차이점은 inner join이 아닌 left join으로 조인한다는 것입니다.

</details>

### 영속성 컨텍스트(persistence context)에 대해서 설명해주세요

<details>

엔티티들을 저장하고 관리하는 공간을 말합니다.

</details>

### 엔티티에 대해서 설명해주세요

<details>

데이터베이스 테이블과 1:1 매칭되는 클래스를 엔티티라고 합니다. 이 엔티티는 영속성 컨텍스트에서 관리되어 여러 이점을 얻을 수 있습니다.

</details>

### 엔티티 생명주기에 대해서 설명해주세요

<details>

엔티티의 상태는 준영속성, 영속성, 비영속성, 삭제가 있습니다.
비영속성은 영속성 컨텍스트에서 관리되지 않는 전혀 관계없는 객체를 말합니다.
영속성은 영속성 컨텍스트에서 관리되고 있는 객체를 말합니다.
준영속성은 영속성 컨텍스트에서 관리되다가 분리된 엔티티를 말하고 삭제는 영속성 컨텍스트와 데이터베이스에서 삭제된 객체를 말합니다.

</details>

### 영속성 컨텍스트를 쓰게 되면 이점에 대해서 설명해주세요

<details>

1차 캐시, 동일성 보장, 지연 로딩, 쓰기 지연, 변경 감지(dirty checking)이 있습니다.
1차 캐시는 영속성 컨텍스트에 엔티티들을 저장하고 해당 엔티티를 또 사용해야 될 때 데이터베이스까지 거치지 않고 바로 캐시에서 꺼내어 사용할 수 있게 해주는 것을 말합니다.
쓰기 지연은 매번 쿼리문을 발생시킬 때마다 커넥션 객체를 이용해서 db에 접근하는 것이 아니라 모든 쿼리문을 모아놨다가 트랜잭션이 끝날 시점에 한꺼번에 쿼리문을 보내는 것을 말합니다.
지연 로딩은 연관 관계가 있는 엔티티를 조회할 때 바로 가져오는 것이 아니라 필요로할 때 쿼리문을 발생 시켜 가져오는 것을 말하고 이를 통해 불필요한 데이터 참조를 줄일 수 있습니다.
변경 감지는 영속성 컨텍스트에서 관리되는 객체라면 사용자가 직접 쿼리문을 만들어주지 않아도 자동으로 변경된 엔티티를 감지하여 쿼리문으로 만들어 업데이트를 시켜주는 것을 말합니다.
동일성 보장은 영속성 컨텍스트에서 관리되고 있는 엔티티를 가져올 때 항상 같은 주소를 가질 수 있게 동일성을 보장하는 것을 말합니다.

</details>

### dirty checking에 대해서 설명해주세요

<details>

트랜잭션이 끝나는 시점에 영속성 컨텍스트에서 관리되는 엔티티 중에서 변화가 있는 엔티티를 찾아서 데이터베이스 자동으로 반영시켜주는 것을 말합니다.

</details>

### 기본키 매핑 방식에 대해서 설명해주세요

<details>

직접 할당하는 방식과 자동 생성 방식이 있습니다.
직접 할당하는 방식은 사용자가 @Id를 통해서 직접 주키를 설정하는 방식이고 자동 생성 방식은 @GeneratedValue를 이용해 기본키 생성 방식을 데이터베이스에 위임하는 방식입니다.
자동 생성 방식에는 IDENTITY, SEQUENCE, TABLE, AUTO로 나눠져있습니다.
identity는 키 생성 방법을 DB에 위임하는 방식입니다.
sequence는 db sequence object를 사용하는 방식입니다.
table는 키 생성 전용 테이블을 따로 만들어서 키를 관리하는 방식입니다.
auto는 벤더에 따라 자동으로 설정되는 방식입니다.

</details>

### 낙관적, 비관적 잠금에 대해서 설명해주세요

<details>

낙관적 잠금은 동시에 데이터 갱신이 일어나지 않을 것이라고 보는 것을 말합니다. 예를 들어 회원정보 변경이 있습니다.
비관적 잠금은 동시에 데이터 갱신이 발생할 것이라 보고 잠금을 거는 것을 말합니다. 예로 계좌이체나 재고 변경이 있습니다.

</details>